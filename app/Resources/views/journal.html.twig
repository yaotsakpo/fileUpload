{% extends 'base.html.twig' %}

{% block stylesheets %}

<link href="{{ asset ('css/bootstrap-table.css') }}" rel="stylesheet">

{% endblock %}

{% block body %}
    {% for message in app.flashes('notice') %}

    <div class="alert bg-success" role="alert">
      <svg class="glyph stroked checkmark">
        <use xlink:href="#stroked-checkmark"></use></svg> {{ message }}  
      <a href="#" class="pull-right"><span class="glyphicon glyphicon-remove"></span></a>
    </div>

    {% endfor %}
     {% set etat = 0 %}
    <div class="col-lg-12">
      <a class="btn btn-primary" href="{{ path('homepage')}}" style="margin:2%">retour</a>
      {% if journalArray[0].dispatch != 1 %}
      <a onclick="return confirm('confirmez?')" class="btn btn-success pull-right" href="{{ path('exportationJournal',{'importation':importation}) }}" style="margin:2%">Exporter le journal en format CSV</a>
        {% endif %}
              <div class="panel panel-default">
                     <div class="panel panel-default">
                                <div class="panel-body">
                                     <table data-toggle="table" data-show-refresh="true" data-show-toggle="true" data-show-columns="true" data-search="true" data-select-item-name="toolbar1" data-pagination="true" data-sort-name="name" data-sort-order="desc">
                                        <thead>
                                        <tr>
                                            <th data-field="jour"  >Jour</th>
                                            <th ddata-field="NumPiece">Numero Piece</th>
                                            <th data-field="NumFact">Numero Facture</th>
                                            <th data-field="Ref">Reference</th>
                                            <th data-field="NumCompteGen">Numero de Compte General</th>
                                            <th data-field="NumCptTiers">Numero Compte Tiers</th>
                                            <th data-field="Libecriture">Libelle Ecriture</th>
                                            <th data-field="DateEcheance">Date Echeance</th>
                                            <th data-field="PositionJournal">Position Journal</th>
                                            <th data-field="debit">Debit</th>
                                            <th data-field="Credit">Credit</th>
                                            <th data-field="action">Action</th>

                                        </tr>                           
                                        </thead>
                                        <tbody>
                                            {% for journal in journalArray %}
                                            <tr>
                                                <td>{{ journal.jour|date('d-m-Y H:m:s') }}</td> 
                                                <td>{{ journal.numPiece }}</td> 
                                                <td>{{ journal.numFacture }}</td> 
                                                <td>{{ journal.reference }}</td> 
                                                <td>{{ journal.numCompteGeneral }}</td> 
                                                <td>{{ journal.numComptTiers }}</td> 
                                                <td>{{ journal.libelleEcriture }}</td> 
                                                <td>{{ journal.dateEcheance }}</td> 
                                                <td>{{ journal.positionJournal }}</td> 
                                                <td>
                                                  {% if journal.montantDebit != null %}
                                                    {{ journal.montantDebit|number_format(2, '.', ' ') }}
                                                  {% endif %}
                                                </td> 
                                                <td>
                                                  {% if journal.montantCredit != null %}
                                                    {{ journal.montantCredit|number_format(2, '.', ' ') }}
                                                  {% endif %}
                                                </td> 
                                                <td>
                                                    {% if journal.cumul == null  and dispatchs == null %}
                                                        <a href="{{ path('dispatch',{'ligneJournal':journal.id}) }}" >
                                                        <button class="btn btn-primary waves-effect" type="submit" >Dispatcher</button></a>
                                                    {% endif %}

                                                    {% if journal.cumul == null  and dispatchs != null and journal.dispatch != null  %}
                                                        {% if journal.dispatch == 0 or journal.dispatch == 1 %}
                                                            {% set etat = 1 %}
                                                    <a href="{{ path('dispatch',{'ligneJournal':journal.id}) }}" >
                                                    <button class="btn btn-primary waves-effect" type="submit" >Dispatcher</button></a>
                                                        {% endif %}
                                                    {% endif %}


                                                    {% if journal.cumul == null  and dispatchs != null and etat == 0 %}
                                                        {% if journal.dispatch == 1 or journal.dispatch == null %}
                                                    <a href="{{ path('dispatch',{'ligneJournal':journal.id}) }}" >
                                                    <button class="btn btn-primary waves-effect" type="submit" >Dispatcher</button></a>
                                                        {% endif %}
                                                    {% endif %}


                                                </td> 
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                    
                                </div>
                            </div>
              </div>
          </div>
    {% endblock %}

{% block javascripts %}


<script src="{{ asset ('js/bootstrap-table.js') }}"></script>

<script type="text/javascript">

</script>

{% endblock %}